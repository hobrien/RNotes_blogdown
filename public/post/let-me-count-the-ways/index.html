<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>let me count the ways</title>
<meta name="description" content="R notes to myself">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/owl.carousel.css">
<link rel="stylesheet" href="/css/owl.theme.css">


  <link href="/css/style.default.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="/img/favicon.png">


</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="/">R notes to myself</a></h1>
    
      <p class="sidebar-p">I am an academic @ UNSW Sydney, mother, and juggler. Learning new things and writing about it. Thoughts probably not suitable for public consumption.</p>
    
    <ul class="sidebar-menu">
      
      
        <li><a href="/about/">About</a></li>
      
        <li><a href="/post/">Blog</a></li>
      
        <li><a href="/projects/">Projects</a></li>
      
        <li><a href="/contact/">Get in touch</a></li>
      
    </ul>
    <p class="social">
  
  
  
  <a href="https://twitter.com/JenRichmondPhD" data-animate-hover="pulse" class="external twitter">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  <a href="mailto:jrichmond@psy.unsw.edu.au" data-animate-hover="pulse" class="email">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  
  
  <a href="https://github.com/jenrichmond" data-animate-hover="pulse" class="external">
    <i class="fa fa-github"></i>
  </a>
  
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2018 Jenny Richmond PhD
        
        | Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="/">R notes to myself</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>let me count the ways</h1>
         <div id="TOC">
true
</div>

<p><a href="https://dominiquemakowski.github.io/">Domnique Makowski</a> has an excellent blog post that comes up at the top of the search results when you type “how to do repeated measures ANOVA in R” into google.</p>
<p><a href="img/google.png">google</a></p>
<p>He lures you in with a <a href="https://neuropsychology.github.io/psycho.R/2018/05/01/repeated_measure_anovas.html">post that seems like it is going to solve all your problems</a> and then and BAM… starts the post by saying DON’T do it.</p>
<p>HAHAHAHAHA- got me….</p>
<div id="psycho-package" class="section level2">
<h2>1. <code>psycho</code> package</h2>
<p>Yes I know that i should be doing linear mixed models instead, so lets see whether his <code>psycho</code> package really makes it as easy as promised.</p>
<pre class="r"><code>library(psycho)
library(lmerTest)</code></pre>
<pre><code>## Loading required package: lme4</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: &#39;lmerTest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:lme4&#39;:
## 
##     lmer</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     step</code></pre>
<pre class="r"><code>emotiondata &lt;- emotion</code></pre>
<div id="recap" class="section level3">
<h3>Recap</h3>
<div id="one-way-anova" class="section level4">
<h4>One way ANOVA</h4>
<p>When we were talking one-way ANOVA we used this formula.</p>
<pre><code>aov(outcome ~ group, data = dataset)</code></pre>
</div>
<div id="repeated-measures-anova" class="section level4">
<h4>Repeated measures ANOVA</h4>
<p>Now that participants contribute to all levels of condition, we need to specify that in the error term. Here the format of the aov call hasn’t changed much.</p>
<pre><code>aov(outcome ~ condition + Error(Participant/condition), data= dataset)
</code></pre>
</div>
<div id="linear-mixed-models" class="section level4">
<h4>Linear mixed models</h4>
<p>The only difference between RM anova and linear mixed models is that you called <code>lmer</code> instead of <code>aov</code> and specify a random effet of Participant (1|Participant) instead of the error term.</p>
<pre><code>lmer(outcome ~ condition + (1|Participant), data= dataset)
</code></pre>
</div>
</div>
<div id="a-psycho-example" class="section level3">
<h3>A psycho example</h3>
<p>L ets imagine we had participants rating the valence of pictures and we wanted to see if there was a difference in the valence ratings for ones that were considered negative vs. neutral. It is a good idea to assign the aov to an object so we can ask for summary or print.</p>
</div>
<div id="old-way-repeated-measures-anova" class="section level3">
<h3>Old way: repeated-measures ANOVA</h3>
<pre class="r"><code>RM_anova &lt;- aov(Subjective_Valence ~ Emotion_Condition +
                  Error(Participant_ID/Emotion_Condition),           data=emotiondata)

summary(RM_anova)</code></pre>
<pre><code>## 
## Error: Participant_ID
##           Df Sum Sq Mean Sq F value Pr(&gt;F)
## Residuals 18 115474    6415               
## 
## Error: Participant_ID:Emotion_Condition
##                   Df  Sum Sq Mean Sq F value   Pr(&gt;F)    
## Emotion_Condition  1 1278417 1278417   245.9 6.11e-12 ***
## Residuals         18   93573    5198                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Error: Within
##            Df Sum Sq Mean Sq F value Pr(&gt;F)
## Residuals 874 935646    1070</code></pre>
<pre class="r"><code># print(RM_anova)</code></pre>
<p>The summary() gives you enough information to write about it in your results, and print() gives extra details about sums of squares etc.</p>
</div>
<div id="new-way-linear-mixed-models" class="section level3">
<h3>New way: Linear mixed models</h3>
<p>Alternatively we can analyse the data using Linear Mixed Models. The code is almost the same, we are still looking at whether valence ratings (outcome) are influenced by emotion condition, but now this is called a “fixed effect”. And instead of specifying the Error term to account for the within subjects nature of the data, we can add Participant to the model as a “random effect”.</p>
<p>Instead of calling aov(), we now use lmer(). Again we assign the model to an object, but this time run an anova() on the object.</p>
<div id="fit-the-model" class="section level4">
<h4>Fit the model</h4>
<pre class="r"><code>library(lmerTest)

lmm_emotion &lt;- lmer(Subjective_Valence ~ Emotion_Condition + (1|Participant_ID), data=emotiondata)

anova(lmm_emotion)</code></pre>
<pre><code>## Type III Analysis of Variance Table with Satterthwaite&#39;s method
##                    Sum Sq Mean Sq NumDF DenDF F value    Pr(&gt;F)    
## Emotion_Condition 1278417 1278417     1   892    1108 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The LMM output is really similarly structured (the sums of squares value is exactly the same) and just like repeated measures ANOVA shows a significant effect of Emotion Condition on valence ratings.</p>
<p>The <code>psycho</code> package also allows you to test the fit of the model and generates a description of the results using an <code>analyze</code> and then <code>print</code> function.</p>
</div>
<div id="the-analyze-function" class="section level4">
<h4>The <code>analyze</code> function</h4>
<pre class="r"><code>results1 &lt;- analyze(lmm_emotion)</code></pre>
<pre><code>## Warning: &#39;r.squaredGLMM&#39; now calculates a revised statistic. See the help
## page.</code></pre>
<pre class="r"><code>print(results1)</code></pre>
<pre><code>## The overall model predicting Subjective_Valence (formula = Subjective_Valence ~ Emotion_Condition + (1 | Participant_ID)) has an total explanatory power (conditional R2) of 56.73%, in which the fixed effects explain 52.62% of the variance (marginal R2). The model&#39;s intercept is at -56.34 (SE = 2.88, 95% CI [-62.07, -50.61]). Within this model:
##    - The effect of Emotion_ConditionNeutral is significant (beta = 74.88, SE = 2.25, 95% CI [70.47, 79.29], t(892) = 33.29, p &lt; .001) and can be considered as large (std. beta = 1.45, std. SE = 0.044).</code></pre>
<p>It would be nice to know, which way that Emotion effect went. Next steps in the <code>psycho</code> process is to run contrasts; you use <code>get_contrasts</code>, add them to the results and print them too</p>
</div>
<div id="get_contrasts" class="section level4">
<h4><code>get_contrasts</code></h4>
<pre class="r"><code>results1 &lt;- get_contrasts(lmm_emotion, &quot;Emotion_Condition&quot;)
print(results1$contrasts)</code></pre>
<pre><code>##             Contrast Difference       SE  df   t.ratio       p.value
## 1 Negative - Neutral  -74.88053 2.249594 892 -33.28625 1.446577e-158</code></pre>
<p>What if there were two fixed effects? In this model, we add sex as an additional predictor. As in one way anova, by specifying Emotion * Sex, you are really saying we want main effects of emotion, sex, and the interaction.</p>
</div>
<div id="a-more-complex-model-w-interaction" class="section level4">
<h4>A more complex model w interaction</h4>
<pre class="r"><code>lmm_emotion_sex &lt;- lmer(Subjective_Valence ~ Emotion_Condition * Participant_Sex + (1|Participant_ID), data=emotiondata)

anova(lmm_emotion_sex)</code></pre>
<pre><code>## Type III Analysis of Variance Table with Satterthwaite&#39;s method
##                                   Sum Sq Mean Sq NumDF DenDF  F value
## Emotion_Condition                 703963  703963     1   891 621.8068
## Participant_Sex                      520     520     1    17   0.4593
## Emotion_Condition:Participant_Sex  20496   20496     1   891  18.1041
##                                      Pr(&gt;F)    
## Emotion_Condition                 &lt; 2.2e-16 ***
## Participant_Sex                      0.5071    
## Emotion_Condition:Participant_Sex 2.313e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre class="r"><code>results2 &lt;- get_contrasts(lmm_emotion_sex, &quot;Emotion_Condition * Participant_Sex&quot;) #note this by default uses Tukey correction

print(results2$means) #get estimated marginal means</code></pre>
<pre><code>##   Emotion_Condition Participant_Sex      Mean       SE       df
## 1          Negative          Female -59.73080 3.280003 23.30494
## 2           Neutral          Female  20.04585 3.280003 23.30494
## 3          Negative            Male -43.62600 6.351698 23.30494
## 4           Neutral            Male  12.89408 6.351698 23.30494
##      CI_lower CI_higher
## 1 -66.5110961 -52.95051
## 2  13.2655523  26.82614
## 3 -56.7559761 -30.49601
## 4  -0.2359003  26.02406</code></pre>
<pre class="r"><code>print(results2$contrasts)</code></pre>
<pre><code>##                           Contrast Difference       SE        df
## 1 Negative,Female - Neutral,Female -79.776648 2.507904 891.00000
## 2  Negative,Female - Negative,Male -16.104808 7.148600  23.30494
## 3   Negative,Female - Neutral,Male -72.624884 7.148600  23.30494
## 4   Neutral,Female - Negative,Male  63.671841 7.148600  23.30494
## 5    Neutral,Female - Neutral,Male   7.151765 7.148600  23.30494
## 6     Negative,Male - Neutral,Male -56.520076 4.856535 891.00000
##      t.ratio      p.value
## 1 -31.810091 0.000000e+00
## 2  -2.252862 1.386356e-01
## 3 -10.159316 2.868312e-09
## 4   8.906897 3.347341e-08
## 5   1.000443 7.506245e-01
## 6 -11.637943 0.000000e+00</code></pre>
<p>Default on get_contrasts is Tukey correction, below with adjustment for multiple comparisons removed.</p>
<pre class="r"><code>results2 &lt;- get_contrasts(lmm_emotion_sex, &quot;Emotion_Condition * Participant_Sex&quot;, adjust = &quot;none&quot;)
print(results2$contrasts)</code></pre>
<pre><code>##                           Contrast Difference       SE        df
## 1 Negative,Female - Neutral,Female -79.776648 2.507904 891.00000
## 2  Negative,Female - Negative,Male -16.104808 7.148600  23.30494
## 3   Negative,Female - Neutral,Male -72.624884 7.148600  23.30494
## 4   Neutral,Female - Negative,Male  63.671841 7.148600  23.30494
## 5    Neutral,Female - Neutral,Male   7.151765 7.148600  23.30494
## 6     Negative,Male - Neutral,Male -56.520076 4.856535 891.00000
##      t.ratio       p.value
## 1 -31.810091 5.703483e-149
## 2  -2.252862  3.397484e-02
## 3 -10.159316  4.930633e-10
## 4   8.906897  5.781252e-09
## 5   1.000443  3.273715e-01
## 6 -11.637943  3.052226e-29</code></pre>
</div>
</div>
<div id="summary-of-psycho-process" class="section level3">
<h3>Summary of <code>psycho</code> process</h3>
<ol style="list-style-type: decimal">
<li><p>define the model and and run it</p>
<p>model &lt;- lmer(outcome ~ fixed_effects + (1|random_effect), data=dataset)</p></li>
</ol>
<p>2A. then</p>
<pre><code>   anova(model)
   </code></pre>
<p>2B. OR</p>
<pre><code>   summary(model)
   </code></pre>
<ol start="3" style="list-style-type: decimal">
<li><p>to get user friendly descriptions you can plug into other things</p>
<p>results &lt;- analyze(model)</p></li>
<li><p>to get all info in both ANOVA and regression format</p>
<p>summary(results)</p></li>
<li><p>to get manuscript ready descriptions use</p>
<p>print(results)</p></li>
<li><p>to work out interactions</p>
<p>get_contrasts(model)</p></li>
</ol>
</div>
</div>
<div id="lmertest-tutorial-per-bruum-brockhoff" class="section level2">
<h2>2. lmerTest tutorial (Per Bruum Brockhoff)</h2>
<p>UWS course ## 3. Page Paccini course</p>
</div>

         
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.cookie.js"> </script>
<script src="/js/ekko-lightbox.js"></script>
<script src="/js/jquery.scrollTo.min.js"></script>
<script src="/js/masonry.pkgd.min.js"></script>
<script src="/js/imagesloaded.pkgd.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/front.js"></script>

</body>
</html>
